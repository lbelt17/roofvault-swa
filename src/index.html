<!DOCTYPE html>
<html>
  <head><meta charset="utf-8"><title>RoofVault SWA</title></head>
  <body style="font-family: system-ui; padding: 24px;">
    <h1>RoofVault SWA — API test</h1>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button id="btnPing">Ping API (GET)</button>
      <button id="btnGen">Generate 5 questions (IIBEC-biased)</button>
      <button id="btnSum">Summarize publication</button>
      <button id="btnGroup">Group questions into sections/objectives</button>
    </div>
    <pre id="out" style="white-space:pre-wrap; margin-top:16px; border:1px solid #ccc; padding:12px;"></pre>
    <script>
      const out = document.getElementById('out');
      function show(obj){
        try { out.textContent = typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2); }
        catch { out.textContent = String(obj); }
      }
      async function call(path, body){
        const opts = body ? { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)} : { method:'GET' };
        const res = await fetch(path, opts);
        const txt = await res.text();
        let data; try { data=JSON.parse(txt);} catch { data=txt; }
        return { status: res.status, ok: res.ok, data };
      }

      window.lastItems = null;

      document.getElementById('btnPing').onclick = async () => {
        show(await call('/api/ping'));
      };
      document.getElementById('btnGen').onclick = async () => {
        const r = await call('/api/generate-questions', { count: 5, onlyIIBEC: true });
        if (r.ok && r.data && r.data.items) { window.lastItems = r.data.items; }
        show(r);
      };
      document.getElementById('btnSum').onclick = async () => {
        show(await call('/api/summarize-publication', { publication: "IIBEC", onlyIIBEC: true }));
      };
      document.getElementById('btnGroup').onclick = async () => {
        if (!window.lastItems) { show({ error: "No items to group yet. Click 'Generate 5 questions' first." }); return; }
        const r = await call('/api/group-questions', { items: window.lastItems });
        show(r);
      };
    </script>
  </body>
</html>
